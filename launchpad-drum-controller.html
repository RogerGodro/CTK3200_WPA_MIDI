<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Launchpad Drum Controller - CTK-3200</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00ffcc;
            --secondary: #ff00aa;
            --background: #0a0a0f;
            --surface: #1a1a24;
            --surface-bright: #252535;
            --text: #e0e0e8;
            --text-dim: #8888a0;
            --border: #2a2a3a;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff3366;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeIn 0.8s ease-out;
        }

        h1 {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 0.9rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .control-panel {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            animation: slideUp 0.6s ease-out;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: var(--surface-bright);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .status-card.connected::before {
            opacity: 1;
        }

        .status-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .status-value {
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            color: var(--text);
            font-weight: 600;
        }

        .controls-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .control-group {
            flex: 1;
            min-width: 250px;
        }

        label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        select, input[type="number"] {
            width: 100%;
            padding: 12px 16px;
            background: var(--surface-bright);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
        }

        select:focus, input[type="number"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 255, 204, 0.1);
        }

        select:hover, input[type="number"]:hover {
            border-color: var(--primary);
        }

        .tempo-control {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .tempo-control input {
            flex: 1;
        }

        .tempo-display {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            min-width: 100px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--primary), #00ddaa);
            color: var(--background);
            border: none;
            border-radius: 8px;
            font-family: 'Orbitron', monospace;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 255, 204, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 204, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(135deg, var(--secondary), #dd0088);
            box-shadow: 0 4px 12px rgba(255, 0, 170, 0.3);
        }

        .btn.secondary:hover {
            box-shadow: 0 6px 20px rgba(255, 0, 170, 0.4);
        }

        .launchpad-grid {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            animation: slideUp 0.8s ease-out;
        }

        .grid-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .grid-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
        }

        .user-mode {
            display: flex;
            gap: 10px;
        }

        .user-btn {
            padding: 8px 20px;
            background: var(--surface-bright);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-dim);
            font-family: 'Orbitron', monospace;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-btn.active {
            background: var(--primary);
            color: var(--background);
            border-color: var(--primary);
        }

        .pad-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .pad {
            aspect-ratio: 1;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s, opacity 0.15s ease;
            position: relative;
            overflow: hidden;
        }

        .pad::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: all 0.4s;
        }

        .pad:active::before {
            width: 100%;
            height: 100%;
        }

        .pad:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 16px rgba(0, 255, 204, 0.3);
        }

        .pad.intro { background: #0066ff; border-color: #0066ff; }
        .pad.main { background: #00aaff; border-color: #00aaff; }
        .pad.variation { background: #ff3366; border-color: #ff3366; }
        .pad.outro { background: #ff6633; border-color: #ff6633; }
        .pad.inactive { background: #ffaa00; border-color: #ffaa00; opacity: 0.6; }
        .pad.off { background: var(--surface-bright); border-color: var(--border); }
        
        .pad.active {
            box-shadow: 0 0 20px currentColor;
            animation: pulse 1s infinite;
        }

        .right-column {
            display: grid;
            grid-template-rows: repeat(8, 1fr);
            gap: 8px;
        }

        .side-btn {
            aspect-ratio: 1;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            text-align: center;
            padding: 4px;
        }

        .side-btn:hover {
            transform: scale(1.05);
        }

        .side-btn.drumset {
            background: var(--surface-bright);
            color: var(--text-dim);
        }

        .side-btn.drumset.active {
            background: var(--success);
            color: var(--background);
            box-shadow: 0 0 20px var(--success);
        }

        .side-btn.stop {
            background: var(--danger);
            color: white;
        }

        .side-btn.pause {
            background: var(--warning);
            color: var(--background);
        }

        .bottom-row {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .bottom-btn {
            aspect-ratio: 1;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface-bright);
            color: var(--text-dim);
            font-size: 1.2rem;
        }

        .bottom-btn:hover {
            transform: scale(1.05);
            background: var(--primary);
            color: var(--background);
        }

        .group-label {
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.6rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .info-panel {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .info-panel h3 {
            color: var(--primary);
            font-family: 'Orbitron', monospace;
            margin-bottom: 10px;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 2px solid var(--border);
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .pad-grid { gap: 4px; }
            .control-panel { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Launchpad Drum Controller</h1>
            <p class="subtitle">CTK-3200 Rhythm System</p>
        </header>

        <div class="control-panel">
            <div class="status-grid">
                <div class="status-card" id="launchpadStatus">
                    <div class="status-label">Launchpad MK2</div>
                    <div class="status-value">D√©connect√©</div>
                </div>
                <div class="status-card" id="ctkStatus">
                    <div class="status-label">CTK-3200</div>
                    <div class="status-value">D√©connect√©</div>
                </div>
                <div class="status-card">
                    <div class="status-label">Drum Set Actuel</div>
                    <div class="status-value" id="currentDrumset">STANDARD</div>
                    <div style="font-size: 0.7rem; color: var(--text-dim); margin-top: 5px;" id="currentDrumsetProgram">Program 0</div>
                </div>
                <div class="status-card">
                    <div class="status-label">√âtat</div>
                    <div class="status-value" id="playbackState">Arr√™t√©</div>
                </div>
            </div>

            <div class="controls-row">
                <div class="control-group">
                    <label for="rhythmSelect">S√©lectionner un groupe de rythme</label>
                    <select id="rhythmSelect">
                        <option value="">-- Choisir --</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="tempoInput">Tempo (BPM)</label>
                    <div class="tempo-control">
                        <input type="number" id="tempoInput" min="40" max="240" value="120">
                        <div class="tempo-display" id="tempoDisplay">120</div>
                    </div>
                </div>
            </div>

            <div class="controls-row">
                <button class="btn" onclick="connectDevices()">Connecter les appareils</button>
                <button class="btn secondary" onclick="stopAllRhythms()">Arr√™ter tout</button>
                <button class="btn secondary" onclick="togglePause()">Pause/Resume</button>
                <button class="btn" style="background: linear-gradient(135deg, #ff1493, #ff69b4);" onclick="playFill('fillLeft')">üé∏ Fill Left</button>
                <button class="btn" style="background: linear-gradient(135deg, #ff69b4, #ff1493);" onclick="playFill('fillRight')">ü•Å Fill Right</button>
            </div>

            <div class="controls-row" style="margin-top: 10px;">
                <div style="font-size: 0.85rem; color: var(--text-dim); width: 100%;">
                    <strong>Test rapide des drum sets:</strong> Cliquez sur les boutons ci-dessous pour tester
                </div>
            </div>
            <div class="controls-row" style="flex-wrap: wrap; gap: 10px;">
                <button class="btn" style="padding: 8px 16px; font-size: 0.9rem;" onclick="selectDrumset(0)">DS0: STANDARD</button>
                <button class="btn" style="padding: 8px 16px; font-size: 0.9rem;" onclick="selectDrumset(1)">DS1: ROOM</button>
                <button class="btn" style="padding: 8px 16px; font-size: 0.9rem;" onclick="selectDrumset(2)">DS2: POWER</button>
                <button class="btn" style="padding: 8px 16px; font-size: 0.9rem;" onclick="selectDrumset(3)">DS3: SYNTH</button>
                <button class="btn" style="padding: 8px 16px; font-size: 0.9rem;" onclick="selectDrumset(4)">DS4: BRUSH</button>
                <button class="btn" style="padding: 8px 16px; font-size: 0.9rem;" onclick="selectDrumset(5)">DS5: ORCHESTRA</button>
            </div>
        </div>

        <div class="launchpad-grid">
            <div class="grid-header">
                <div class="grid-title">Contr√¥leur de pads</div>
                <div class="user-mode">
                    <button class="user-btn active" onclick="switchUserMode(1)">USER 1</button>
                    <button class="user-btn" onclick="switchUserMode(2)">USER 2</button>
                </div>
            </div>

            <div style="display: flex; gap: 8px;">
                <div class="pad-grid" id="padGrid"></div>
                <div class="right-column" id="rightColumn"></div>
            </div>

            <div class="bottom-row" id="bottomRow"></div>
        </div>

        <div class="info-panel">
            <h3>Instructions</h3>
            <p style="margin-bottom: 15px;">
                <strong>Connexion:</strong> Cliquez sur "Connecter les appareils" pour connecter votre Launchpad MK2 et CTK-3200. 
                L'application peut √©galement fonctionner en mode simulation si les appareils ne sont pas connect√©s.
            </p>
            <p style="margin-bottom: 15px;">
                <strong>üêõ D√âBOGAGE:</strong> Ouvrez la console du navigateur (F12 ou Ctrl+Shift+I) pour voir les logs d√©taill√©s. 
                Chaque action affiche des messages dans la console pour diagnostiquer les probl√®mes.
                <span style="background: var(--surface-bright); padding: 2px 6px; border-radius: 3px; margin-left: 5px;">
                    Appuyez sur F12 maintenant!
                </span>
            </p>
            <p style="margin-bottom: 15px;">
                <strong>üéµ 32 Rythmes Uniques:</strong> Chaque groupe (USER 1: 0-15, USER 2: 16-31) offre un rythme complet et unique 
                avec intro musicale (16 temps), corps (loop), variation (loop), outro grandiose (8 temps), 
                et 2 fills cr√©atifs avec hand claps, sifflets, shakers, cowbell, etc.
            </p>
            <p style="margin-bottom: 15px;">
                <strong>Navigation:</strong> Utilisez le menu d√©roulant pour s√©lectionner un groupe de rythme, 
                ou cliquez directement sur les pads. Basculez entre USER 1 et USER 2 pour acc√©der aux 32 groupes.
            </p>
            <p style="margin-bottom: 15px;">
                <strong>üéµ Transitions Musicales:</strong><br>
                ‚Ä¢ <strong>Tempo:</strong> Les changements de tempo conservent la position dans la mesure<br>
                ‚Ä¢ <strong>Main/Variation:</strong> La transition attend la fin de la boucle actuelle (pas de coupure)<br>
                ‚Ä¢ <strong>Intro/Outro:</strong> Transition imm√©diate possible<br>
                ‚Ä¢ <strong>Clignotement:</strong> Les deux pads clignotent pendant la transition planifi√©e<br>
                ‚Ä¢ <strong>√âtat:</strong> "Lecture ‚Üí Corps" indique une transition en attente
            </p>
            <p style="margin-bottom: 15px;">
                <strong>Contr√¥les Launchpad (si connect√©):</strong><br>
                ‚Ä¢ <strong>Pads 8√ó8:</strong> D√©marrer les rythmes (intro/corps/variation/outro)<br>
                ‚Ä¢ <strong>Boutons de droite:</strong> 6 premiers = drum sets, 7e = STOP, 8e = PAUSE<br>
                ‚Ä¢ <strong>Bouton Left (haut):</strong> üé∏ Fill cr√©atif gauche (rose - actif pendant rythme)<br>
                ‚Ä¢ <strong>Bouton Right (haut):</strong> ü•Å Fill cr√©atif droite (rose - actif pendant rythme)<br>
                ‚Ä¢ <strong>Bouton User 1 (haut):</strong> Activer USER 1 (vert = actif, √©teint = inactif)<br>
                ‚Ä¢ <strong>Bouton User 2 (haut):</strong> Activer USER 2 (vert = actif, √©teint = inactif)<br>
                ‚Ä¢ <strong>Bouton Up (haut):</strong> Tempo +5 BPM (bleu)<br>
                ‚Ä¢ <strong>Bouton Down (haut):</strong> Tempo -5 BPM (bleu)
            </p>
            
            <h3>L√©gende des pads</h3>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color intro"></div>
                    <span>Intro (16 temps)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color main"></div>
                    <span>Corps (loop)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color variation"></div>
                    <span>Variation (loop)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color outro"></div>
                    <span>Outro (8 temps)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color inactive"></div>
                    <span>Inactif (autre groupe joue)</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const DRUM_SETS = [
            { id: 0, name: 'STANDARD', program: 0 },
            { id: 1, name: 'ROOM', program: 8 },
            { id: 2, name: 'POWER', program: 16 },
            { id: 3, name: 'SYNTH', program: 17 },
            { id: 4, name: 'BRUSH', program: 40 },
            { id: 5, name: 'ORCHESTRA', program: 48 }
        ];

        const RHYTHM_GROUPS = [
            // USER 1 (16 groupes)
            { id: 0, name: 'Rock Standard', user: 1 },
            { id: 1, name: 'Pop Groove', user: 1 },
            { id: 2, name: 'Ballad Soft', user: 1 },
            { id: 3, name: 'Funk Drive', user: 1 },
            { id: 4, name: 'Blues Shuffle', user: 1 },
            { id: 5, name: 'Jazz Swing', user: 1 },
            { id: 6, name: 'Latin Fire', user: 1 },
            { id: 7, name: 'Reggae One', user: 1 },
            { id: 8, name: 'Country Beat', user: 1 },
            { id: 9, name: 'Soul Pocket', user: 1 },
            { id: 10, name: 'Disco Fever', user: 1 },
            { id: 11, name: 'R&B Smooth', user: 1 },
            { id: 12, name: 'Gospel Spirit', user: 1 },
            { id: 13, name: 'Metal Blast', user: 1 },
            { id: 14, name: 'Punk Energy', user: 1 },
            { id: 15, name: 'Indie Alt', user: 1 },
            // USER 2 (16 groupes)
            { id: 16, name: 'Electronic House', user: 2 },
            { id: 17, name: 'Techno Pulse', user: 2 },
            { id: 18, name: 'Dubstep Drop', user: 2 },
            { id: 19, name: 'Trap 808', user: 2 },
            { id: 20, name: 'Hip Hop Boom', user: 2 },
            { id: 21, name: 'Breakbeat', user: 2 },
            { id: 22, name: 'Drum n Bass', user: 2 },
            { id: 23, name: 'Ambient Chill', user: 2 },
            { id: 24, name: 'World Percussion', user: 2 },
            { id: 25, name: 'Afrobeat', user: 2 },
            { id: 26, name: 'Bossa Nova', user: 2 },
            { id: 27, name: 'Samba Heat', user: 2 },
            { id: 28, name: 'Flamenco Fire', user: 2 },
            { id: 29, name: 'Middle Eastern', user: 2 },
            { id: 30, name: 'Industrial', user: 2 },
            { id: 31, name: 'Experimental', user: 2 }
        ];

        // √âtat global
        let midiInputLaunchpad = null;
        let midiOutputLaunchpad = null;
        let midiOutputCTK = null;
        let currentUserMode = 1;
        let currentDrumset = 0;
        let tempo = 120;
        let isPlaying = false;
        let isPaused = false;
        let activeGroup = null;
        let activeSection = null; // 'intro', 'main', 'variation', 'outro'
        let pendingSection = null; // Section en attente pour transition fluide
        let pendingGroup = null; // Groupe en attente pour transition fluide
        let beatPosition = 0;
        let intervalId = null;
        let blinkIntervalId = null; // Pour le clignotement pendant transition
        let isPlayingFill = false; // Indique si un fill est en cours
        let fillType = null; // 'fillLeft' ou 'fillRight'
        let sectionBeforeFill = null; // Pour revenir apr√®s le fill
        let groupBeforeFill = null; // Groupe avant le fill

        // Notes MIDI (General MIDI Drum Map)
        const DRUM_NOTES = {
            kick: 36,      // Bass Drum 1
            snare: 38,     // Acoustic Snare
            hihat: 42,     // Closed Hi-Hat
            openhat: 46,   // Open Hi-Hat
            crash: 49,     // Crash Cymbal 1
            ride: 51,      // Ride Cymbal 1
            lowtom: 45,    // Low Tom
            midtom: 47,    // Mid Tom
            hightom: 50,   // High Tom
            clap: 39,      // Hand Clap
            cowbell: 56,   // Cowbell
            tambourine: 54, // Tambourine
            whistle: 71,   // Short Whistle
            shaker: 82     // Shaker
        };

        // Biblioth√®que compl√®te de 32 rythmes uniques
        const DRUM_PATTERNS_LIBRARY = {
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // USER 1 - RYTHMES TRADITIONNELS
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            
            // 0. Rock Standard
            0: {
                intro: {
                    kick: [0, 8],
                    snare: [4, 12],
                    hightom: [2, 6, 10, 14],
                    crash: [0],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    length: 16
                },
                main: {
                    kick: [0, 6, 8, 14],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    length: 16
                },
                variation: {
                    kick: [0, 3, 6, 8, 11, 14],
                    snare: [4, 12],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    crash: [8],
                    length: 16
                },
                outro: {
                    kick: [0, 4],
                    snare: [2, 6],
                    crash: [0, 4],
                    hightom: [1, 3, 5, 7],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 2, 4, 6],
                    hightom: [1, 3, 5, 7],
                    length: 8
                },
                fillRight: {
                    kick: [0, 4],
                    hightom: [1, 2],
                    midtom: [3, 4],
                    lowtom: [5, 6],
                    crash: [7],
                    length: 8
                }
            },

            // 1. Pop Groove
            1: {
                intro: {
                    clap: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    shaker: [1, 3, 5, 7, 9, 11, 13, 15],
                    kick: [8],
                    snare: [12],
                    length: 16
                },
                main: {
                    kick: [0, 6, 10],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    clap: [4, 12],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 13],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    openhat: [7, 15],
                    tambourine: [2, 6, 10, 14],
                    length: 16
                },
                outro: {
                    kick: [0, 2, 4, 6],
                    clap: [1, 3, 5, 7],
                    crash: [0],
                    length: 8
                },
                fillLeft: {
                    clap: [0, 2, 4, 6],
                    tambourine: [1, 3, 5, 7],
                    length: 8
                },
                fillRight: {
                    snare: [0, 1, 2, 3, 4, 5, 6, 7],
                    kick: [0, 4],
                    length: 8
                }
            },

            // 2. Ballad Soft
            2: {
                intro: {
                    ride: [0, 4, 8, 12],
                    kick: [12],
                    snare: [14],
                    length: 16
                },
                main: {
                    kick: [0, 8],
                    snare: [4, 12],
                    ride: [0, 2, 4, 6, 8, 10, 12, 14],
                    length: 16
                },
                variation: {
                    kick: [0, 6, 8, 14],
                    snare: [4, 12],
                    ride: [0, 2, 4, 6, 8, 10, 12, 14],
                    crash: [0],
                    length: 16
                },
                outro: {
                    kick: [0],
                    snare: [2, 4],
                    ride: [0, 2, 4, 6],
                    crash: [0, 6],
                    length: 8
                },
                fillLeft: {
                    snare: [2, 4, 6],
                    hightom: [0, 2, 4, 6],
                    length: 8
                },
                fillRight: {
                    ride: [0, 2, 4, 6],
                    crash: [7],
                    length: 8
                }
            },

            // 3. Funk Drive
            3: {
                intro: {
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    kick: [0, 6, 12],
                    snare: [8],
                    crash: [0],
                    length: 16
                },
                main: {
                    kick: [0, 6, 10, 12],
                    snare: [4],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    openhat: [2, 6, 10, 14],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 11, 12, 15],
                    snare: [4],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    clap: [8],
                    length: 16
                },
                outro: {
                    kick: [0, 1, 2, 3, 4, 5, 6, 7],
                    snare: [0, 2, 4, 6],
                    crash: [0, 7],
                    length: 8
                },
                fillLeft: {
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7],
                    snare: [2, 4, 6],
                    length: 8
                },
                fillRight: {
                    cowbell: [0, 2, 4, 6],
                    kick: [0, 4],
                    clap: [7],
                    length: 8
                }
            },

            // 4. Blues Shuffle
            4: {
                intro: {
                    ride: [0, 3, 6, 9, 12, 15],
                    kick: [0, 12],
                    snare: [6],
                    length: 16
                },
                main: {
                    kick: [0, 9, 12],
                    snare: [6],
                    ride: [0, 3, 6, 9, 12, 15],
                    length: 16
                },
                variation: {
                    kick: [0, 3, 9, 12, 15],
                    snare: [6],
                    ride: [0, 3, 6, 9, 12, 15],
                    openhat: [6],
                    length: 16
                },
                outro: {
                    kick: [0, 3, 6],
                    snare: [2, 4],
                    crash: [0, 6],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 3, 6],
                    hightom: [1, 4],
                    midtom: [2, 5],
                    length: 8
                },
                fillRight: {
                    ride: [0, 2, 4, 6],
                    kick: [0, 6],
                    length: 8
                }
            },

            // 5. Jazz Swing
            5: {
                intro: {
                    ride: [0, 3, 6, 9, 12, 15],
                    kick: [0],
                    hihat: [4, 12],
                    length: 16
                },
                main: {
                    kick: [0, 6, 12],
                    snare: [4, 10],
                    ride: [0, 3, 6, 9, 12, 15],
                    hihat: [2, 8, 14],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 11, 12],
                    snare: [4, 10, 13],
                    ride: [0, 3, 6, 9, 12, 15],
                    crash: [0],
                    length: 16
                },
                outro: {
                    kick: [0, 4],
                    snare: [2, 6],
                    ride: [0, 2, 4, 6],
                    crash: [0, 6],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 2, 4, 6],
                    ride: [1, 3, 5, 7],
                    length: 8
                },
                fillRight: {
                    hightom: [0, 1],
                    midtom: [2, 3],
                    lowtom: [4, 5],
                    crash: [6],
                    length: 8
                }
            },

            // 6. Latin Fire
            6: {
                intro: {
                    cowbell: [0, 2, 4, 6, 8, 10, 12, 14],
                    clap: [4, 12],
                    shaker: [1, 3, 5, 7, 9, 11, 13, 15],
                    kick: [12],
                    length: 16
                },
                main: {
                    kick: [0, 6, 10],
                    snare: [4, 12],
                    cowbell: [0, 2, 4, 6, 8, 10, 12, 14],
                    shaker: [1, 3, 5, 7, 9, 11, 13, 15],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 13],
                    snare: [4, 8, 12],
                    cowbell: [0, 2, 4, 6, 8, 10, 12, 14],
                    clap: [2, 10, 14],
                    tambourine: [1, 3, 5, 7, 9, 11, 13, 15],
                    length: 16
                },
                outro: {
                    kick: [0, 2, 4, 6],
                    cowbell: [0, 1, 2, 3, 4, 5, 6, 7],
                    crash: [0, 6],
                    length: 8
                },
                fillLeft: {
                    cowbell: [0, 2, 4, 6],
                    clap: [1, 3, 5, 7],
                    length: 8
                },
                fillRight: {
                    tambourine: [0, 1, 2, 3, 4, 5, 6, 7],
                    kick: [0, 4],
                    length: 8
                }
            },

            // 7. Reggae One
            7: {
                intro: {
                    hihat: [2, 6, 10, 14],
                    snare: [0, 4, 8, 12],
                    kick: [12],
                    length: 16
                },
                main: {
                    kick: [0, 6, 8, 14],
                    snare: [2, 10],
                    hihat: [4, 12],
                    openhat: [6, 14],
                    length: 16
                },
                variation: {
                    kick: [0, 6, 8, 10, 14],
                    snare: [2, 10],
                    hihat: [4, 12],
                    clap: [4, 12],
                    cowbell: [1, 5, 9, 13],
                    length: 16
                },
                outro: {
                    kick: [0, 6],
                    snare: [2, 4],
                    hihat: [0, 2, 4, 6],
                    crash: [0],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 2, 4, 6],
                    hihat: [1, 3, 5, 7],
                    length: 8
                },
                fillRight: {
                    cowbell: [0, 2, 4, 6],
                    clap: [7],
                    length: 8
                }
            },

            // 8. Country Beat
            8: {
                intro: {
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    kick: [0, 8],
                    snare: [4, 12],
                    crash: [0],
                    length: 16
                },
                main: {
                    kick: [0, 6, 8, 14],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    length: 16
                },
                variation: {
                    kick: [0, 6, 8, 10, 14],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    tambourine: [2, 6, 10, 14],
                    length: 16
                },
                outro: {
                    kick: [0, 2, 4],
                    snare: [1, 3, 5, 6, 7],
                    crash: [0],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 2, 4, 6],
                    kick: [0, 4],
                    length: 8
                },
                fillRight: {
                    hightom: [0, 2],
                    midtom: [4],
                    lowtom: [6],
                    kick: [0, 6],
                    length: 8
                }
            },

            // 9. Soul Pocket
            9: {
                intro: {
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    clap: [4, 12],
                    tambourine: [2, 6, 10, 14],
                    kick: [8, 12],
                    length: 16
                },
                main: {
                    kick: [0, 5, 10],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    clap: [8],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 13],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    openhat: [7, 15],
                    tambourine: [1, 5, 9, 13],
                    length: 16
                },
                outro: {
                    kick: [0, 4],
                    clap: [0, 2, 4, 6],
                    tambourine: [1, 3, 5, 7],
                    crash: [0],
                    length: 8
                },
                fillLeft: {
                    clap: [0, 2, 4, 6],
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7],
                    length: 8
                },
                fillRight: {
                    snare: [0, 2, 4, 6],
                    tambourine: [1, 3, 5, 7],
                    length: 8
                }
            },

            // 10. Disco Fever
            10: {
                intro: {
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    kick: [0, 8],
                    clap: [4, 12],
                    crash: [0],
                    length: 16
                },
                main: {
                    kick: [0, 4, 8, 12],
                    snare: [4, 12],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    openhat: [2, 6, 10, 14],
                    length: 16
                },
                variation: {
                    kick: [0, 3, 4, 8, 11, 12],
                    snare: [4, 12],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    clap: [2, 6, 10, 14],
                    crash: [0, 8],
                    length: 16
                },
                outro: {
                    kick: [0, 2, 4, 6],
                    clap: [0, 1, 2, 3, 4, 5, 6, 7],
                    crash: [0, 4],
                    length: 8
                },
                fillLeft: {
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7],
                    clap: [0, 4],
                    length: 8
                },
                fillRight: {
                    cowbell: [0, 2, 4, 6],
                    kick: [0, 4],
                    crash: [7],
                    length: 8
                }
            },

            // 11. R&B Smooth
            11: {
                intro: {
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    hihat: [0, 4, 8, 12],
                    snare: [12],
                    kick: [14],
                    length: 16
                },
                main: {
                    kick: [0, 6, 10],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    shaker: [1, 3, 5, 7, 9, 11, 13, 15],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 13, 15],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    clap: [8],
                    tambourine: [1, 5, 9, 13],
                    length: 16
                },
                outro: {
                    kick: [0, 4],
                    snare: [2, 6],
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7],
                    crash: [0],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 2, 4, 6],
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7],
                    length: 8
                },
                fillRight: {
                    tambourine: [0, 1, 2, 3, 4, 5, 6, 7],
                    clap: [0, 4],
                    length: 8
                }
            },

            // 12. Gospel Spirit
            12: {
                intro: {
                    clap: [0, 2, 4, 6, 8, 10, 12, 14],
                    tambourine: [1, 3, 5, 7, 9, 11, 13, 15],
                    kick: [0, 8],
                    crash: [0],
                    length: 16
                },
                main: {
                    kick: [0, 6, 10],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    clap: [4, 12],
                    tambourine: [1, 5, 9, 13],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 13],
                    snare: [4, 8, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    clap: [2, 4, 10, 12, 14],
                    tambourine: [1, 3, 5, 7, 9, 11, 13, 15],
                    length: 16
                },
                outro: {
                    kick: [0, 2, 4, 6],
                    clap: [0, 1, 2, 3, 4, 5, 6, 7],
                    tambourine: [0, 1, 2, 3, 4, 5, 6, 7],
                    crash: [0, 6],
                    length: 8
                },
                fillLeft: {
                    clap: [0, 1, 2, 3, 4, 5, 6, 7],
                    kick: [0, 4],
                    length: 8
                },
                fillRight: {
                    tambourine: [0, 1, 2, 3, 4, 5, 6, 7],
                    clap: [0, 2, 4, 6],
                    length: 8
                }
            },

            // 13. Metal Blast
            13: {
                intro: {
                    kick: [0, 2, 4, 6, 8, 10, 12, 14],
                    crash: [0, 8],
                    hihat: [1, 3, 5, 7, 9, 11, 13, 15],
                    length: 16
                },
                main: {
                    kick: [0, 2, 4, 6, 8, 10, 12, 14],
                    snare: [4, 12],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    length: 16
                },
                variation: {
                    kick: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    snare: [4, 12],
                    crash: [0, 8],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    length: 16
                },
                outro: {
                    kick: [0, 1, 2, 3, 4, 5, 6, 7],
                    crash: [0, 2, 4, 6],
                    snare: [1, 3, 5, 7],
                    length: 8
                },
                fillLeft: {
                    hightom: [0, 1, 2, 3],
                    midtom: [4, 5],
                    lowtom: [6, 7],
                    length: 8
                },
                fillRight: {
                    snare: [0, 1, 2, 3, 4, 5, 6, 7],
                    crash: [0, 7],
                    length: 8
                }
            },

            // 14. Punk Energy
            14: {
                intro: {
                    crash: [0],
                    snare: [2, 4, 6, 10, 12, 14],
                    kick: [0, 8],
                    length: 16
                },
                main: {
                    kick: [0, 2, 4, 6, 8, 10, 12, 14],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    crash: [0],
                    length: 16
                },
                variation: {
                    kick: [0, 1, 2, 4, 6, 8, 10, 12, 14],
                    snare: [3, 4, 11, 12],
                    openhat: [0, 4, 8, 12],
                    crash: [0, 8],
                    length: 16
                },
                outro: {
                    kick: [0, 2, 4, 6],
                    snare: [1, 3, 5, 7],
                    crash: [0, 4],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 1, 2, 3, 4, 5, 6, 7],
                    kick: [0, 4],
                    length: 8
                },
                fillRight: {
                    crash: [0, 4],
                    snare: [2, 6],
                    kick: [0, 2, 4, 6],
                    length: 8
                }
            },

            // 15. Indie Alt
            15: {
                intro: {
                    ride: [0, 2, 4, 6, 8, 10, 12, 14],
                    kick: [0],
                    snare: [8],
                    tambourine: [4, 12],
                    length: 16
                },
                main: {
                    kick: [0, 6, 10],
                    snare: [4, 12],
                    ride: [0, 2, 4, 6, 8, 10, 12, 14],
                    tambourine: [2, 6, 10, 14],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 13],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    crash: [0],
                    clap: [8],
                    length: 16
                },
                outro: {
                    kick: [0, 4],
                    snare: [2, 6],
                    ride: [0, 2, 4, 6],
                    crash: [0, 6],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 2, 4, 6],
                    tambourine: [1, 3, 5, 7],
                    length: 8
                },
                fillRight: {
                    hightom: [0, 2, 4],
                    midtom: [1, 3, 5],
                    crash: [6],
                    length: 8
                }
            },

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // USER 2 - RYTHMES √âLECTRONIQUES ET WORLD
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            // 16. Electronic House
            16: {
                intro: {
                    kick: [0, 4, 8, 12],
                    hihat: [2, 6, 10, 14],
                    clap: [8],
                    crash: [0],
                    length: 16
                },
                main: {
                    kick: [0, 4, 8, 12],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    openhat: [6, 14],
                    length: 16
                },
                variation: {
                    kick: [0, 3, 4, 8, 11, 12],
                    snare: [4, 12],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    clap: [8],
                    length: 16
                },
                outro: {
                    kick: [0, 4],
                    clap: [2, 6],
                    hihat: [0, 2, 4, 6],
                    crash: [0],
                    length: 8
                },
                fillLeft: {
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7],
                    clap: [0, 4],
                    length: 8
                },
                fillRight: {
                    snare: [0, 2, 4, 6],
                    kick: [1, 3, 5, 7],
                    length: 8
                }
            },

            // 17. Techno Pulse
            17: {
                intro: {
                    kick: [0, 4, 8, 12],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    crash: [0],
                    length: 16
                },
                main: {
                    kick: [0, 4, 8, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    clap: [4, 12],
                    openhat: [6, 14],
                    length: 16
                },
                variation: {
                    kick: [0, 2, 4, 6, 8, 10, 12, 14],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    snare: [4, 12],
                    crash: [0],
                    length: 16
                },
                outro: {
                    kick: [0, 2, 4, 6],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7],
                    crash: [0, 6],
                    length: 8
                },
                fillLeft: {
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7],
                    kick: [0, 4],
                    length: 8
                },
                fillRight: {
                    clap: [0, 2, 4, 6],
                    snare: [1, 3, 5, 7],
                    length: 8
                }
            },

            // 18. Dubstep Drop
            18: {
                intro: {
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    snare: [8, 12],
                    kick: [0],
                    length: 16
                },
                main: {
                    kick: [0, 8],
                    snare: [4, 12],
                    hihat: [2, 6, 10, 14],
                    crash: [0],
                    length: 16
                },
                variation: {
                    kick: [0, 3, 8, 11],
                    snare: [4, 6, 12, 14],
                    hihat: [1, 2, 5, 7, 9, 10, 13, 15],
                    crash: [0, 8],
                    length: 16
                },
                outro: {
                    kick: [0],
                    snare: [2, 4, 6],
                    crash: [0, 6],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 1, 2, 3, 4, 5, 6, 7],
                    length: 8
                },
                fillRight: {
                    kick: [0, 4],
                    lowtom: [2, 6],
                    crash: [7],
                    length: 8
                }
            },

            // 19. Trap 808
            19: {
                intro: {
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    snare: [8],
                    kick: [12],
                    length: 16
                },
                main: {
                    kick: [0, 6],
                    snare: [4, 12],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    openhat: [3, 7, 11, 15],
                    length: 16
                },
                variation: {
                    kick: [0, 3, 6, 9],
                    snare: [4, 10, 12, 14],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    clap: [8],
                    length: 16
                },
                outro: {
                    kick: [0, 4],
                    snare: [2, 6],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7],
                    length: 8
                },
                fillLeft: {
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7],
                    snare: [2, 4, 6],
                    length: 8
                },
                fillRight: {
                    snare: [0, 1, 2, 3, 4, 5, 6, 7],
                    kick: [0, 4],
                    length: 8
                }
            },

            // 20. Hip Hop Boom
            20: {
                intro: {
                    kick: [0],
                    snare: [8],
                    hihat: [0, 4, 8, 12],
                    shaker: [2, 6, 10, 14],
                    length: 16
                },
                main: {
                    kick: [0, 6, 10],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    shaker: [3, 7, 11, 15],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 13],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    clap: [8],
                    openhat: [7, 15],
                    length: 16
                },
                outro: {
                    kick: [0, 4],
                    snare: [2, 6],
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 2, 4, 6],
                    hihat: [1, 3, 5, 7],
                    length: 8
                },
                fillRight: {
                    hightom: [0, 2],
                    midtom: [4],
                    lowtom: [6],
                    kick: [0, 6],
                    length: 8
                }
            },

            // 21. Breakbeat
            21: {
                intro: {
                    snare: [0, 3, 6, 9, 12, 15],
                    kick: [0, 8],
                    hihat: [2, 6, 10, 14],
                    length: 16
                },
                main: {
                    kick: [0, 5, 8, 13],
                    snare: [3, 6, 11, 14],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    crash: [0],
                    length: 16
                },
                variation: {
                    kick: [0, 3, 5, 8, 10, 13],
                    snare: [2, 6, 9, 11, 14],
                    hihat: [0, 1, 2, 4, 6, 8, 10, 12, 14],
                    openhat: [7, 15],
                    length: 16
                },
                outro: {
                    kick: [0, 2, 4, 6],
                    snare: [1, 3, 5, 7],
                    crash: [0, 6],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 1, 3, 4, 6, 7],
                    kick: [0, 4],
                    length: 8
                },
                fillRight: {
                    hightom: [0, 1, 2],
                    midtom: [3, 4],
                    lowtom: [5, 6],
                    crash: [7],
                    length: 8
                }
            },

            // 22. Drum n Bass
            22: {
                intro: {
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    kick: [0, 8],
                    snare: [4, 12],
                    crash: [0],
                    length: 16
                },
                main: {
                    kick: [0, 3, 8, 11],
                    snare: [4, 12],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    crash: [0],
                    length: 16
                },
                variation: {
                    kick: [0, 2, 3, 5, 8, 10, 11, 13],
                    snare: [4, 6, 12, 14],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    openhat: [7, 15],
                    length: 16
                },
                outro: {
                    kick: [0, 2, 4, 6],
                    snare: [1, 3, 5, 7],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7],
                    crash: [0],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 1, 2, 3, 4, 5, 6, 7],
                    hihat: [0, 2, 4, 6],
                    length: 8
                },
                fillRight: {
                    kick: [0, 2, 4, 6],
                    snare: [1, 3, 5, 7],
                    length: 8
                }
            },

            // 23. Ambient Chill
            23: {
                intro: {
                    ride: [0, 8],
                    shaker: [2, 6, 10, 14],
                    kick: [12],
                    length: 16
                },
                main: {
                    kick: [0, 8],
                    snare: [6, 14],
                    ride: [0, 4, 8, 12],
                    shaker: [2, 6, 10, 14],
                    length: 16
                },
                variation: {
                    kick: [0, 10],
                    snare: [6, 14],
                    ride: [0, 2, 4, 6, 8, 10, 12, 14],
                    tambourine: [3, 7, 11, 15],
                    length: 16
                },
                outro: {
                    kick: [0],
                    ride: [0, 4],
                    shaker: [2, 6],
                    crash: [0],
                    length: 8
                },
                fillLeft: {
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7],
                    ride: [0, 4],
                    length: 8
                },
                fillRight: {
                    tambourine: [0, 2, 4, 6],
                    ride: [1, 3, 5, 7],
                    length: 8
                }
            },

            // 24. World Percussion
            24: {
                intro: {
                    cowbell: [0, 4, 8, 12],
                    shaker: [2, 6, 10, 14],
                    hightom: [1, 5, 9, 13],
                    lowtom: [3, 7, 11, 15],
                    length: 16
                },
                main: {
                    kick: [0, 6, 10],
                    snare: [4, 12],
                    cowbell: [0, 2, 4, 6, 8, 10, 12, 14],
                    shaker: [1, 3, 5, 7, 9, 11, 13, 15],
                    hightom: [2, 10],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 13],
                    snare: [4, 12],
                    cowbell: [0, 2, 4, 6, 8, 10, 12, 14],
                    tambourine: [1, 3, 5, 7, 9, 11, 13, 15],
                    hightom: [2, 6, 10, 14],
                    lowtom: [3, 7, 11, 15],
                    length: 16
                },
                outro: {
                    cowbell: [0, 2, 4, 6],
                    hightom: [0, 2, 4, 6],
                    lowtom: [1, 3, 5, 7],
                    crash: [0, 6],
                    length: 8
                },
                fillLeft: {
                    cowbell: [0, 2, 4, 6],
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7],
                    length: 8
                },
                fillRight: {
                    hightom: [0, 1, 2, 3],
                    lowtom: [4, 5, 6, 7],
                    length: 8
                }
            },

            // 25. Afrobeat
            25: {
                intro: {
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    cowbell: [0, 4, 8, 12],
                    clap: [6, 14],
                    kick: [12],
                    length: 16
                },
                main: {
                    kick: [0, 6, 10, 12],
                    snare: [4],
                    hihat: [2, 6, 10, 14],
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    cowbell: [0, 4, 8, 12],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 11, 12, 15],
                    snare: [4, 8],
                    hihat: [2, 6, 10, 14],
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    clap: [2, 6, 10, 14],
                    cowbell: [0, 2, 4, 6, 8, 10, 12, 14],
                    length: 16
                },
                outro: {
                    kick: [0, 2, 4, 6],
                    cowbell: [0, 1, 2, 3, 4, 5, 6, 7],
                    clap: [0, 2, 4, 6],
                    crash: [0, 6],
                    length: 8
                },
                fillLeft: {
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7],
                    clap: [0, 2, 4, 6],
                    length: 8
                },
                fillRight: {
                    cowbell: [0, 1, 2, 3, 4, 5, 6, 7],
                    kick: [0, 4],
                    length: 8
                }
            },

            // 26. Bossa Nova
            26: {
                intro: {
                    ride: [0, 3, 6, 9, 12, 15],
                    shaker: [1, 4, 7, 10, 13],
                    kick: [0, 12],
                    length: 16
                },
                main: {
                    kick: [0, 6, 10],
                    snare: [4, 14],
                    ride: [0, 3, 6, 9, 12, 15],
                    shaker: [1, 4, 7, 10, 13],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 13],
                    snare: [4, 11, 14],
                    ride: [0, 3, 6, 9, 12, 15],
                    tambourine: [1, 4, 7, 10, 13],
                    hihat: [2, 8],
                    length: 16
                },
                outro: {
                    kick: [0, 6],
                    ride: [0, 2, 4, 6],
                    shaker: [1, 3, 5, 7],
                    crash: [0],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 3, 6],
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7],
                    length: 8
                },
                fillRight: {
                    tambourine: [0, 1, 2, 3, 4, 5, 6, 7],
                    ride: [0, 3, 6],
                    length: 8
                }
            },

            // 27. Samba Heat
            27: {
                intro: {
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    hightom: [0, 4, 8, 12],
                    lowtom: [2, 6, 10, 14],
                    whistle: [8],
                    length: 16
                },
                main: {
                    kick: [0, 6, 8, 14],
                    snare: [4, 12],
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    hightom: [2, 10],
                    tambourine: [0, 4, 8, 12],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 8, 13, 14],
                    snare: [4, 12],
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    hightom: [2, 6, 10, 14],
                    lowtom: [3, 7, 11, 15],
                    tambourine: [0, 2, 4, 6, 8, 10, 12, 14],
                    whistle: [0, 8],
                    length: 16
                },
                outro: {
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7],
                    hightom: [0, 2, 4, 6],
                    lowtom: [1, 3, 5, 7],
                    whistle: [0, 4],
                    crash: [0],
                    length: 8
                },
                fillLeft: {
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7],
                    whistle: [0, 4],
                    length: 8
                },
                fillRight: {
                    hightom: [0, 1, 2, 3],
                    lowtom: [4, 5, 6, 7],
                    tambourine: [0, 2, 4, 6],
                    length: 8
                }
            },

            // 28. Flamenco Fire
            28: {
                intro: {
                    clap: [0, 2, 3, 6, 8, 10, 11, 14],
                    hightom: [4, 12],
                    kick: [0, 8],
                    length: 16
                },
                main: {
                    kick: [0, 6, 10],
                    snare: [4, 12],
                    clap: [0, 2, 3, 6, 8, 10, 11, 14],
                    hightom: [1, 9],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 13],
                    snare: [4, 12],
                    clap: [0, 1, 2, 3, 6, 8, 9, 10, 11, 14],
                    hightom: [2, 7, 10, 15],
                    midtom: [4, 12],
                    length: 16
                },
                outro: {
                    clap: [0, 1, 2, 3, 4, 5, 6, 7],
                    hightom: [0, 2, 4, 6],
                    crash: [0],
                    length: 8
                },
                fillLeft: {
                    clap: [0, 1, 2, 3, 4, 5, 6, 7],
                    kick: [0, 4],
                    length: 8
                },
                fillRight: {
                    hightom: [0, 1, 2, 3],
                    midtom: [4, 5],
                    lowtom: [6, 7],
                    length: 8
                }
            },

            // 29. Middle Eastern
            29: {
                intro: {
                    hightom: [0, 3, 6, 9, 12, 15],
                    lowtom: [2, 5, 8, 11, 14],
                    tambourine: [1, 4, 7, 10, 13],
                    length: 16
                },
                main: {
                    kick: [0, 6, 10],
                    snare: [4, 12],
                    hightom: [0, 3, 6, 9, 12, 15],
                    tambourine: [1, 5, 9, 13],
                    length: 16
                },
                variation: {
                    kick: [0, 5, 6, 10, 13],
                    snare: [4, 8, 12],
                    hightom: [0, 2, 3, 6, 8, 9, 12, 14, 15],
                    lowtom: [1, 5, 7, 11, 13],
                    tambourine: [1, 3, 5, 7, 9, 11, 13, 15],
                    length: 16
                },
                outro: {
                    hightom: [0, 2, 4, 6],
                    lowtom: [1, 3, 5, 7],
                    tambourine: [0, 1, 2, 3, 4, 5, 6, 7],
                    crash: [0],
                    length: 8
                },
                fillLeft: {
                    hightom: [0, 2, 4, 6],
                    tambourine: [0, 1, 2, 3, 4, 5, 6, 7],
                    length: 8
                },
                fillRight: {
                    lowtom: [0, 2, 4, 6],
                    hightom: [1, 3, 5, 7],
                    length: 8
                }
            },

            // 30. Industrial
            30: {
                intro: {
                    kick: [0, 4, 8, 12],
                    snare: [2, 6, 10, 14],
                    crash: [0, 8],
                    hihat: [1, 3, 5, 7, 9, 11, 13, 15],
                    length: 16
                },
                main: {
                    kick: [0, 2, 4, 6, 8, 10, 12, 14],
                    snare: [4, 12],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    crash: [0],
                    length: 16
                },
                variation: {
                    kick: [0, 1, 2, 4, 6, 8, 10, 12, 14],
                    snare: [3, 4, 11, 12],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    crash: [0, 8],
                    cowbell: [2, 6, 10, 14],
                    length: 16
                },
                outro: {
                    kick: [0, 1, 2, 3, 4, 5, 6, 7],
                    crash: [0, 2, 4, 6],
                    snare: [1, 3, 5, 7],
                    length: 8
                },
                fillLeft: {
                    snare: [0, 1, 2, 3, 4, 5, 6, 7],
                    crash: [0, 4],
                    length: 8
                },
                fillRight: {
                    cowbell: [0, 2, 4, 6],
                    kick: [0, 2, 4, 6],
                    crash: [7],
                    length: 8
                }
            },

            // 31. Experimental
            31: {
                intro: {
                    whistle: [0, 8],
                    shaker: [2, 4, 6, 10, 12, 14],
                    hightom: [3, 11],
                    lowtom: [7, 15],
                    length: 16
                },
                main: {
                    kick: [0, 7, 10],
                    snare: [5, 13],
                    hihat: [2, 6, 9, 14],
                    cowbell: [1, 4, 8, 12],
                    shaker: [3, 7, 11, 15],
                    length: 16
                },
                variation: {
                    kick: [0, 3, 7, 10, 13],
                    snare: [5, 11, 13],
                    openhat: [2, 6, 9, 14],
                    cowbell: [0, 2, 4, 6, 8, 10, 12, 14],
                    tambourine: [1, 3, 5, 7, 9, 11, 13, 15],
                    whistle: [4, 12],
                    length: 16
                },
                outro: {
                    whistle: [0, 4],
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7],
                    crash: [0, 6],
                    hightom: [2, 6],
                    lowtom: [3, 7],
                    length: 8
                },
                fillLeft: {
                    whistle: [0, 2, 4, 6],
                    shaker: [0, 1, 2, 3, 4, 5, 6, 7],
                    length: 8
                },
                fillRight: {
                    cowbell: [0, 2, 4, 6],
                    tambourine: [1, 3, 5, 7],
                    crash: [7],
                    length: 8
                }
            }
        };

        // Fonction helper pour obtenir le pattern selon le groupe et la section
        function getPattern(groupId, section) {
            const groupPattern = DRUM_PATTERNS_LIBRARY[groupId];
            if (!groupPattern) {
                console.error(`Groupe ${groupId} non trouv√© dans la biblioth√®que`);
                return DRUM_PATTERNS_LIBRARY[0][section]; // Fallback sur Rock Standard
            }
            return groupPattern[section] || groupPattern.main;
        }

        // Initialisation
        function init() {
            populateRhythmSelect();
            createPadGrid();
            createRightColumn();
            createBottomRow();
            updateTempo(120);
            
            // Initialiser l'affichage du drum set
            document.getElementById('currentDrumset').textContent = DRUM_SETS[0].name;
            document.getElementById('currentDrumsetProgram').textContent = `Program ${DRUM_SETS[0].program}`;
            
            document.getElementById('tempoInput').addEventListener('input', (e) => {
                updateTempo(parseInt(e.target.value));
            });

            document.getElementById('rhythmSelect').addEventListener('change', (e) => {
                if (e.target.value !== '') {
                    highlightGroup(parseInt(e.target.value));
                }
            });
            
            console.log('Application initialis√©e');
            console.log('Drum Set par d√©faut:', DRUM_SETS[0].name);
        }

        function populateRhythmSelect() {
            const select = document.getElementById('rhythmSelect');
            RHYTHM_GROUPS.forEach(group => {
                const option = document.createElement('option');
                option.value = group.id;
                option.textContent = `${group.name} (USER ${group.user})`;
                select.appendChild(option);
            });
        }

        function createPadGrid() {
            const grid = document.getElementById('padGrid');
            grid.innerHTML = '';
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const pad = document.createElement('div');
                    pad.className = 'pad off';
                    pad.dataset.row = row;
                    pad.dataset.col = col;
                    pad.addEventListener('click', () => handlePadClick(row, col));
                    
                    // Ajouter le label du groupe
                    if (col % 4 === 0) {
                        const groupIndex = row * 2 + Math.floor(col / 4);
                        const actualGroupId = currentUserMode === 1 ? groupIndex : groupIndex + 16;
                        if (actualGroupId < RHYTHM_GROUPS.length) {
                            const label = document.createElement('div');
                            label.className = 'group-label';
                            label.textContent = `G${actualGroupId + 1}`;
                            pad.appendChild(label);
                        }
                    }
                    
                    grid.appendChild(pad);
                }
            }
            
            updatePadColors();
        }

        function createRightColumn() {
            const column = document.getElementById('rightColumn');
            column.innerHTML = '';
            
            // 6 boutons pour les drum sets (correspondant aux notes 89, 79, 69, 59, 49, 39)
            const drumsetLabels = ['STANDARD', 'ROOM', 'POWER', 'SYNTH', 'BRUSH', 'ORCHESTRA'];
            DRUM_SETS.forEach((drumset, index) => {
                const btn = document.createElement('div');
                btn.className = 'side-btn drumset';
                if (index === currentDrumset) btn.classList.add('active');
                btn.textContent = drumsetLabels[index] || drumset.name;
                btn.title = `${drumset.name} (Note ${[89, 79, 69, 59, 49, 39][index]})`;
                btn.addEventListener('click', () => selectDrumset(index));
                column.appendChild(btn);
            });
            
            // Bouton Stop (note 29 = Solo sur le Launchpad)
            const stopBtn = document.createElement('div');
            stopBtn.className = 'side-btn stop';
            stopBtn.textContent = 'STOP';
            stopBtn.title = 'Arr√™ter le rythme (Note 29)';
            stopBtn.addEventListener('click', stopAllRhythms);
            column.appendChild(stopBtn);
            
            // Bouton Pause (note 19 = Record Arm sur le Launchpad)
            const pauseBtn = document.createElement('div');
            pauseBtn.className = 'side-btn pause';
            pauseBtn.textContent = 'PAUSE';
            pauseBtn.title = 'Pause/Reprendre (Note 19)';
            pauseBtn.addEventListener('click', togglePause);
            column.appendChild(pauseBtn);
        }

        function createBottomRow() {
            const row = document.getElementById('bottomRow');
            row.innerHTML = '';
            
            // 6 boutons vides
            for (let i = 0; i < 6; i++) {
                const btn = document.createElement('div');
                btn.className = 'bottom-btn';
                row.appendChild(btn);
            }
            
            // Up - Tempo + (CC 104)
            const tempoUp = document.createElement('div');
            tempoUp.className = 'bottom-btn';
            tempoUp.textContent = '‚ñ≤';
            tempoUp.title = 'Tempo + (CC 104 = Up)';
            tempoUp.addEventListener('click', () => adjustTempo(5));
            row.appendChild(tempoUp);
            
            // Down - Tempo - (CC 105)
            const tempoDown = document.createElement('div');
            tempoDown.className = 'bottom-btn';
            tempoDown.textContent = '‚ñº';
            tempoDown.title = 'Tempo - (CC 105 = Down)';
            tempoDown.addEventListener('click', () => adjustTempo(-5));
            row.appendChild(tempoDown);
        }

        function updatePadColors() {
            const pads = document.querySelectorAll('.pad');
            pads.forEach(pad => {
                const row = parseInt(pad.dataset.row);
                const col = parseInt(pad.dataset.col);
                const groupIndex = row * 2 + Math.floor(col / 4);
                const actualGroupId = currentUserMode === 1 ? groupIndex : groupIndex + 16;
                const padType = col % 4;
                
                pad.classList.remove('intro', 'main', 'variation', 'outro', 'inactive', 'active', 'off');
                
                if (actualGroupId >= RHYTHM_GROUPS.length) {
                    pad.classList.add('off');
                    return;
                }
                
                if (activeGroup !== null && activeGroup !== actualGroupId) {
                    pad.classList.add('inactive');
                } else {
                    switch (padType) {
                        case 0: pad.classList.add('intro'); break;
                        case 1: pad.classList.add('main'); break;
                        case 2: pad.classList.add('variation'); break;
                        case 3: pad.classList.add('outro'); break;
                    }
                }
                
                // Marquer le pad actif
                if (activeGroup === actualGroupId) {
                    const sectionMap = ['intro', 'main', 'variation', 'outro'];
                    if (sectionMap[padType] === activeSection) {
                        pad.classList.add('active');
                    }
                }
            });
            
            // Synchroniser avec le Launchpad physique
            syncLaunchpadColors();
        }

        function handlePadClick(row, col) {
            const groupIndex = row * 2 + Math.floor(col / 4);
            const actualGroupId = currentUserMode === 1 ? groupIndex : groupIndex + 16;
            const padType = col % 4;
            const sections = ['intro', 'main', 'variation', 'outro'];
            
            if (actualGroupId >= RHYTHM_GROUPS.length) return;
            
            playSection(actualGroupId, sections[padType]);
        }

        function playSection(groupId, section) {
            console.log(`‚ïê‚ïê‚ïê Demande de lecture: Groupe ${groupId}, Section ${section} ‚ïê‚ïê‚ïê`);
            
            // Si rien ne joue, d√©marrer imm√©diatement
            if (!isPlaying) {
                console.log('Aucun rythme en cours ‚Üí D√©marrage imm√©diat');
                startNewSection(groupId, section);
                return;
            }
            
            // Si c'est le m√™me groupe et la m√™me section, ignorer
            if (activeGroup === groupId && activeSection === section) {
                console.log('M√™me section d√©j√† active ‚Üí Ignor√©');
                return;
            }
            
            // Si on est sur intro ou outro, transition imm√©diate
            if (activeSection === 'intro' || activeSection === 'outro') {
                console.log(`Section ${activeSection} ‚Üí Transition imm√©diate`);
                startNewSection(groupId, section);
                return;
            }
            
            // Si on est sur main ou variation, planifier la transition √† la fin de la boucle
            if (activeSection === 'main' || activeSection === 'variation') {
                const pattern = DRUM_PATTERNS[activeSection];
                const beatsRemaining = pattern.length - beatPosition;
                
                console.log(`Section ${activeSection} en cours (beat ${beatPosition}/${pattern.length})`);
                console.log(`‚Üí Transition planifi√©e dans ${beatsRemaining} beats`);
                
                pendingSection = section;
                pendingGroup = groupId;
                
                // Mettre √† jour l'affichage
                updatePlaybackState();
                
                // D√©marrer le clignotement pour indiquer la transition en attente
                startTransitionBlink(groupId, section);
                
                return;
            }
            
            // Sinon, d√©marrer imm√©diatement (fallback)
            startNewSection(groupId, section);
        }

        function playFill(type) {
            if (!isPlaying || isPaused) {
                console.log('‚ö†Ô∏è Aucun rythme en cours - Fill ignor√©');
                return;
            }
            
            if (isPlayingFill) {
                console.log('‚ö†Ô∏è Fill d√©j√† en cours - Fill ignor√©');
                return;
            }
            
            console.log(`‚ïê‚ïê‚ïê Fill ${type} d√©clench√© ‚ïê‚ïê‚ïê`);
            
            // Sauvegarder la section actuelle
            sectionBeforeFill = activeSection;
            groupBeforeFill = activeGroup;
            
            // Passer en mode fill
            isPlayingFill = true;
            fillType = type;
            beatPosition = 0;
            
            // Red√©marrer le playback avec le pattern de fill
            stopPlayback();
            startPlayback();
        }

        function endFill() {
            console.log('‚úì Fill termin√© - Retour √† la section pr√©c√©dente');
            
            isPlayingFill = false;
            fillType = null;
            beatPosition = 0;
            
            // Restaurer la section d'avant
            activeSection = sectionBeforeFill;
            activeGroup = groupBeforeFill;
            
            // Red√©marrer le playback
            stopPlayback();
            startPlayback();
        }

        function startNewSection(groupId, section) {
            stopPlayback();
            stopTransitionBlink();
            
            activeGroup = groupId;
            activeSection = section;
            pendingSection = null;
            pendingGroup = null;
            beatPosition = 0;
            isPlaying = true;
            isPaused = false;
            isPlayingFill = false;
            fillType = null;
            
            console.log(`‚úì D√©marrage: Groupe ${groupId}, Section ${section}`);
            
            updatePadColors();
            updatePlaybackState();
            
            startPlayback();
        }

        function startTransitionBlink(groupId, section) {
            stopTransitionBlink(); // Arr√™ter tout clignotement pr√©c√©dent
            
            let blinkState = false;
            blinkIntervalId = setInterval(() => {
                blinkState = !blinkState;
                
                // Faire clignoter les pads concern√©s
                const pads = document.querySelectorAll('.pad');
                pads.forEach(pad => {
                    const row = parseInt(pad.dataset.row);
                    const col = parseInt(pad.dataset.col);
                    const groupIndex = row * 2 + Math.floor(col / 4);
                    const actualGroupId = currentUserMode === 1 ? groupIndex : groupIndex + 16;
                    const padType = col % 4;
                    const sections = ['intro', 'main', 'variation', 'outro'];
                    
                    // Clignoter le pad actuel ET le pad en attente
                    const isCurrentPad = (actualGroupId === activeGroup && sections[padType] === activeSection);
                    const isPendingPad = (actualGroupId === groupId && sections[padType] === section);
                    
                    if (isCurrentPad || isPendingPad) {
                        pad.style.opacity = blinkState ? '1' : '0.3';
                    }
                });
            }, 150); // Clignoter toutes les 150ms
        }

        function stopTransitionBlink() {
            if (blinkIntervalId) {
                clearInterval(blinkIntervalId);
                blinkIntervalId = null;
                
                // Remettre l'opacit√© normale
                const pads = document.querySelectorAll('.pad');
                pads.forEach(pad => {
                    pad.style.opacity = '1';
                });
            }
        }

        function startPlayback() {
            if (!midiOutputCTK && !intervalId) {
                console.log('Mode simulation actif');
            }
            
            // D√©terminer quelle section/fill jouer
            const sectionToPlay = isPlayingFill ? fillType : activeSection;
            const pattern = getPattern(activeGroup, sectionToPlay);
            const beatDuration = (60 / tempo) * 1000 / 4; // Dur√©e d'un 16√®me de note en ms
            
            if (isPlayingFill) {
                console.log(`D√©marrage fill - Type: ${fillType}, Pattern length: ${pattern.length}`);
            } else {
                console.log(`D√©marrage playback - Groupe: ${activeGroup}, Section: ${activeSection}, Tempo: ${tempo}, Pattern length: ${pattern.length}`);
            }
            
            intervalId = setInterval(() => {
                if (isPaused) return;
                
                playBeat(beatPosition, pattern);
                beatPosition++;
                
                // V√©rifier si on a atteint la fin de la boucle
                if (beatPosition >= pattern.length) {
                    beatPosition = 0;
                    
                    // Si c'√©tait un fill, revenir √† la section d'avant
                    if (isPlayingFill) {
                        endFill();
                        return;
                    }
                    
                    console.log(`Fin de boucle ${activeSection} (${pattern.length} beats)`);
                    
                    // G√©rer la transition automatique de l'intro
                    if (activeSection === 'intro') {
                        console.log('Intro termin√©e ‚Üí Passage automatique au corps');
                        startNewSection(activeGroup, 'main');
                        return;
                    }
                    
                    // G√©rer la transition automatique de l'outro
                    if (activeSection === 'outro') {
                        console.log('Outro termin√©e ‚Üí Arr√™t automatique');
                        stopAllRhythms();
                        return;
                    }
                    
                    // G√©rer les transitions planifi√©es (depuis main ou variation)
                    if (pendingSection !== null) {
                        console.log(`Transition planifi√©e d√©tect√©e ‚Üí ${pendingSection}`);
                        const nextGroup = pendingGroup;
                        const nextSection = pendingSection;
                        startNewSection(nextGroup, nextSection);
                        return;
                    }
                    
                    // Sinon, continuer de boucler (main et variation)
                    console.log(`Bouclage de ${activeSection}`);
                }
            }, beatDuration);
        }

        function playBeat(position, pattern) {
            const channel = 9; // Canal 10 (0-indexed) pour les drums
            
            // Jouer toutes les notes actives √† cette position pour tous les instruments
            Object.keys(pattern).forEach(instrumentName => {
                if (instrumentName === 'length') return; // Skip la propri√©t√© length
                
                const positions = pattern[instrumentName];
                if (positions && positions.includes(position)) {
                    const note = DRUM_NOTES[instrumentName];
                    if (!note) {
                        console.warn(`Instrument inconnu: ${instrumentName}`);
                        return;
                    }
                    
                    const velocity = 100;
                    
                    if (midiOutputCTK) {
                        // Note ON
                        midiOutputCTK.send([0x90 + channel, note, velocity]);
                        
                        // Note OFF apr√®s 50ms
                        setTimeout(() => {
                            if (midiOutputCTK) {
                                midiOutputCTK.send([0x80 + channel, note, 0]);
                            }
                        }, 50);
                    } else {
                        // Mode simulation - logging minimal
                        // console.log(`Beat ${position}: ${instrumentName} (note ${note})`);
                    }
                }
            });
        }

        function stopPlayback() {
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }
        }

        function stopAllRhythms() {
            console.log('‚ïê‚ïê‚ïê STOP D√âCLENCH√â ‚ïê‚ïê‚ïê');
            console.log('Arr√™t du rythme en cours...');
            
            stopPlayback();
            stopTransitionBlink();
            
            activeGroup = null;
            activeSection = null;
            pendingSection = null;
            pendingGroup = null;
            beatPosition = 0;
            isPlaying = false;
            isPaused = false;
            isPlayingFill = false;
            fillType = null;
            sectionBeforeFill = null;
            groupBeforeFill = null;
            
            // Envoyer All Notes Off seulement si CTK est connect√©
            if (midiOutputCTK) {
                try {
                    midiOutputCTK.send([0xB9, 123, 0]); // All Notes Off sur canal 10
                    console.log('‚úì All Notes Off envoy√© au CTK-3200');
                } catch (error) {
                    console.error('Erreur lors de l\'envoi de All Notes Off:', error);
                }
            } else {
                console.warn('‚ö†Ô∏è CTK-3200 non connect√©');
            }
            
            updatePadColors();
            updatePlaybackState();
            syncLaunchpadColors();
            console.log('‚úì Rythme arr√™t√©');
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        }

        function togglePause() {
            console.log('‚ïê‚ïê‚ïê PAUSE/RESUME D√âCLENCH√â ‚ïê‚ïê‚ïê');
            
            if (!isPlaying) {
                console.log('‚ö†Ô∏è Aucun rythme en cours - PAUSE ignor√©');
                console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
                return;
            }
            
            isPaused = !isPaused;
            console.log(`√âtat: ${isPaused ? 'EN PAUSE' : 'LECTURE'}`);
            
            updatePlaybackState();
            
            // Synchroniser avec le Launchpad
            syncLaunchpadColors();
            console.log('‚úì √âtat mis √† jour');
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        }

        function selectDrumset(index) {
            if (index < 0 || index >= DRUM_SETS.length) {
                console.error(`Index de drum set invalide: ${index}`);
                return;
            }
            
            currentDrumset = index;
            const drumset = DRUM_SETS[index];
            
            console.log(`‚ïê‚ïê‚ïê S√©lection Drum Set ${index} ‚ïê‚ïê‚ïê`);
            console.log(`Nom: ${drumset.name}`);
            console.log(`Program: ${drumset.program}`);
            
            if (midiOutputCTK) {
                // Envoyer Program Change sur canal 10 (drums)
                const channel = 9; // Canal 10 = index 9
                const programChange = [0xC0 + channel, drumset.program];
                console.log(`‚Üí Envoi Program Change: [${programChange[0].toString(16)}, ${programChange[1]}]`);
                midiOutputCTK.send(programChange);
                console.log('‚úì Program Change envoy√© au CTK-3200');
            } else {
                console.warn('‚ö†Ô∏è CTK-3200 non connect√© - mode simulation');
            }
            
            document.getElementById('currentDrumset').textContent = drumset.name;
            document.getElementById('currentDrumsetProgram').textContent = `Program ${drumset.program}`;
            console.log(`Interface mise √† jour: ${drumset.name}`);
            
            // Mettre √† jour les boutons de l'interface
            document.querySelectorAll('.side-btn.drumset').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            
            // Synchroniser avec le Launchpad
            console.log('Synchronisation des LEDs du Launchpad...');
            syncLaunchpadColors();
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        }

        function switchUserMode(mode) {
            if (currentUserMode === mode) return;
            
            currentUserMode = mode;
            
            // Mettre √† jour les boutons
            document.querySelectorAll('.user-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i + 1 === mode);
            });
            
            createPadGrid();
            
            // Synchroniser avec le Launchpad
            syncLaunchpadColors();
        }

        function highlightGroup(groupId) {
            const group = RHYTHM_GROUPS.find(g => g.id === groupId);
            if (!group) return;
            
            // Changer de mode USER si n√©cessaire
            if (group.user !== currentUserMode) {
                switchUserMode(group.user);
            }
            
            // Trouver et mettre en √©vidence les pads du groupe
            setTimeout(() => {
                const pads = document.querySelectorAll('.pad');
                pads.forEach(pad => {
                    const row = parseInt(pad.dataset.row);
                    const col = parseInt(pad.dataset.col);
                    const groupIndex = row * 2 + Math.floor(col / 4);
                    const actualGroupId = group.user === 1 ? groupIndex : groupIndex + 16;
                    
                    if (actualGroupId === groupId) {
                        pad.style.animation = 'pulse 0.5s ease-in-out 3';
                        setTimeout(() => {
                            pad.style.animation = '';
                        }, 1500);
                    }
                });
            }, 100);
        }

        function updateTempo(newTempo) {
            tempo = Math.max(40, Math.min(240, newTempo));
            document.getElementById('tempoInput').value = tempo;
            document.getElementById('tempoDisplay').textContent = tempo;
            
            // Si un rythme est en cours, ajuster l'intervalle sans red√©marrer
            if (isPlaying && !isPaused && intervalId) {
                console.log(`Changement de tempo: ${tempo} BPM - Position ${beatPosition} maintenue`);
                stopPlayback(); // Arr√™ter l'ancien intervalle
                startPlayback(); // Red√©marrer avec le nouveau tempo, mais garde beatPosition
            }
        }

        function adjustTempo(delta) {
            const oldTempo = tempo;
            updateTempo(tempo + delta);
            
            // Feedback visuel sur l'affichage du tempo
            const tempoDisplay = document.getElementById('tempoDisplay');
            tempoDisplay.style.transform = 'scale(1.2)';
            tempoDisplay.style.color = delta > 0 ? '#00ff88' : '#ff6600';
            
            setTimeout(() => {
                tempoDisplay.style.transform = 'scale(1)';
                tempoDisplay.style.color = 'var(--primary)';
            }, 200);
        }

        function updatePlaybackState() {
            let stateText = isPaused ? 'En pause' : (isPlaying ? 'Lecture' : 'Arr√™t√©');
            
            // Ajouter l'info de transition si en attente
            if (pendingSection !== null) {
                const sectionNames = { intro: 'Intro', main: 'Corps', variation: 'Variation', outro: 'Outro' };
                stateText += ` ‚Üí ${sectionNames[pendingSection] || pendingSection}`;
            }
            
            document.getElementById('playbackState').textContent = stateText;
        }

        // Connexion MIDI
        async function connectDevices() {
            if (!navigator.requestMIDIAccess) {
                alert('Web MIDI API non support√©e par ce navigateur');
                return;
            }

            try {
                // Demander l'acc√®s MIDI avec support SysEx
                const midiAccess = await navigator.requestMIDIAccess({ sysex: true });
                
                console.log('Appareils MIDI disponibles:');
                console.log('Inputs:', Array.from(midiAccess.inputs.values()).map(i => i.name));
                console.log('Outputs:', Array.from(midiAccess.outputs.values()).map(o => o.name));
                
                // Trouver le Launchpad
                for (let input of midiAccess.inputs.values()) {
                    if (input.name.toLowerCase().includes('launchpad')) {
                        midiInputLaunchpad = input;
                        midiInputLaunchpad.onmidimessage = handleLaunchpadMessage;
                        document.getElementById('launchpadStatus').classList.add('connected');
                        document.querySelector('#launchpadStatus .status-value').textContent = 'Connect√©';
                        console.log('Launchpad input connect√©:', input.name);
                    }
                }
                
                for (let output of midiAccess.outputs.values()) {
                    if (output.name.toLowerCase().includes('launchpad')) {
                        midiOutputLaunchpad = output;
                        console.log('Launchpad output connect√©:', output.name);
                        initializeLaunchpad();
                    }
                    if (output.name.toLowerCase().includes('ctk') || 
                        output.name.toLowerCase().includes('casio') ||
                        output.name.toLowerCase().includes('keyboard')) {
                        midiOutputCTK = output;
                        document.getElementById('ctkStatus').classList.add('connected');
                        document.querySelector('#ctkStatus .status-value').textContent = 'Connect√©';
                        console.log('CTK-3200 output connect√©:', output.name);
                        selectDrumset(0); // Initialiser avec STANDARD SET
                    }
                }
                
                if (!midiInputLaunchpad || !midiOutputLaunchpad) {
                    console.warn('Launchpad MK2 non trouv√©');
                    alert('Launchpad MK2 non trouv√©. V√©rifiez qu\'il est bien connect√©.');
                }
                if (!midiOutputCTK) {
                    console.warn('CTK-3200 non trouv√©');
                    alert('CTK-3200 non trouv√©. L\'application peut quand m√™me √™tre utilis√©e sans le clavier.');
                }
            } catch (error) {
                console.error('Erreur de connexion MIDI:', error);
                alert('Erreur lors de la connexion MIDI: ' + error.message);
            }
        }

        function initializeLaunchpad() {
            if (!midiOutputLaunchpad) return;
            
            try {
                // Mettre le Launchpad MK2 en mode programmeur (Programmer Mode)
                // SysEx: F0h 00h 20h 29h 02h 18h 0Eh 01h F7h
                midiOutputLaunchpad.send([0xF0, 0x00, 0x20, 0x29, 0x02, 0x18, 0x0E, 0x01, 0xF7]);
                
                console.log('Launchpad initialis√© en mode programmeur');
                
                // Attendre que le Launchpad soit pr√™t, puis effacer et synchroniser
                setTimeout(() => {
                    // Effacer toutes les LEDs des pads (notes 11-88)
                    for (let row = 1; row <= 8; row++) {
                        for (let col = 1; col <= 8; col++) {
                            const note = row * 10 + col;
                            midiOutputLaunchpad.send([0x90, note, 0]);
                        }
                    }
                    
                    // Effacer les boutons de droite (notes 89, 79, 69, 59, 49, 39, 29, 19)
                    [89, 79, 69, 59, 49, 39, 29, 19].forEach(note => {
                        midiOutputLaunchpad.send([0x90, note, 0]);
                    });
                    
                    // Effacer les boutons du haut (CC 104-111)
                    for (let cc = 104; cc <= 111; cc++) {
                        midiOutputLaunchpad.send([0xB0, cc, 0]);
                    }
                    
                    // Synchroniser les couleurs
                    setTimeout(() => syncLaunchpadColors(), 50);
                }, 100);
                
            } catch (error) {
                console.error('Erreur lors de l\'initialisation du Launchpad:', error);
            }
        }

        function syncLaunchpadColors() {
            if (!midiOutputLaunchpad) return;
            
            // D√©finir les couleurs pour le Launchpad MK2
            const COLORS = {
                off: 0,
                intro: 45,      // Bleu
                main: 37,       // Bleu clair
                variation: 5,   // Rouge
                outro: 9,       // Orange
                inactive: 13,   // Jaune
                active: 21      // Vert brillant pour le pad actif
            };
            
            // Mettre √† jour les pads de la grille 8x8
            // Pattern: note = ligne√ó10 + colonne + 1 (ligne 1 = bas, col 1 = gauche)
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const groupIndex = row * 2 + Math.floor(col / 4);
                    const actualGroupId = currentUserMode === 1 ? groupIndex : groupIndex + 16;
                    const padType = col % 4;
                    
                    // Calculer la note MIDI pour ce pad
                    const note = (row + 1) * 10 + (col + 1);
                    
                    let color = COLORS.off;
                    
                    if (actualGroupId < RHYTHM_GROUPS.length) {
                        if (activeGroup !== null && activeGroup !== actualGroupId) {
                            color = COLORS.inactive;
                        } else {
                            switch (padType) {
                                case 0: color = COLORS.intro; break;
                                case 1: color = COLORS.main; break;
                                case 2: color = COLORS.variation; break;
                                case 3: color = COLORS.outro; break;
                            }
                            
                            // Marquer le pad actif
                            if (activeGroup === actualGroupId) {
                                const sections = ['intro', 'main', 'variation', 'outro'];
                                if (sections[padType] === activeSection) {
                                    color = COLORS.active;
                                }
                            }
                        }
                    }
                    
                    // Envoyer la couleur au Launchpad (Note On)
                    midiOutputLaunchpad.send([0x90, note, color]);
                }
            }
            
            // Mettre √† jour les boutons ronds de droite (Note On: 89, 79, 69, 59, 49, 39, 29, 19)
            const rightButtons = [89, 79, 69, 59, 49, 39, 29, 19];
            const rightButtonNames = ['Volume/DS0', 'Pan/DS1', 'SendA/DS2', 'SendB/DS3', 'Stop/DS4', 'Mute/DS5', 'Solo/STOP', 'RecArm/PAUSE'];
            
            console.log('Mise √† jour LEDs boutons droite:');
            for (let i = 0; i < 8; i++) {
                const note = rightButtons[i];
                let color = COLORS.off;
                
                if (i < 6) {
                    // Boutons de drum sets
                    color = (i === currentDrumset) ? COLORS.active : 19; // Vert si actif, sinon gris
                } else if (i === 6) {
                    // Solo = STOP
                    color = 5; // Rouge
                } else if (i === 7) {
                    // Record Arm = PAUSE
                    color = isPaused ? COLORS.active : 9; // Vert si en pause, orange sinon
                }
                
                console.log(`  ${rightButtonNames[i]} (note ${note}): couleur ${color}`);
                // Envoyer un message Note On pour allumer la LED
                midiOutputLaunchpad.send([0x90, note, color]);
            }
            
            // Mettre √† jour les boutons du haut (CC 104-111)
            // 104=Up, 105=Down, 106=Left, 107=Right, 108=Session, 109=User1, 110=User2, 111=Mixer
            for (let i = 0; i < 8; i++) {
                const cc = 104 + i;
                let color = COLORS.off;
                
                // Up (CC 104) - Tempo +
                if (cc === 104) {
                    color = 45; // Bleu
                }
                // Down (CC 105) - Tempo -
                else if (cc === 105) {
                    color = 45; // Bleu
                }
                // Left (CC 106) - Fill Left
                else if (cc === 106) {
                    color = isPlaying ? 53 : COLORS.off; // Rose si rythme en cours, √©teint sinon
                }
                // Right (CC 107) - Fill Right
                else if (cc === 107) {
                    color = isPlaying ? 53 : COLORS.off; // Rose si rythme en cours, √©teint sinon
                }
                // User 1 (CC 109) - Allum√© en vert si USER 1 actif, √©teint sinon
                else if (cc === 109) {
                    color = currentUserMode === 1 ? COLORS.active : COLORS.off;
                }
                // User 2 (CC 110) - Allum√© en vert si USER 2 actif, √©teint sinon
                else if (cc === 110) {
                    color = currentUserMode === 2 ? COLORS.active : COLORS.off;
                }
                
                midiOutputLaunchpad.send([0xB0, cc, color]);
            }
        }

        function handleLaunchpadMessage(message) {
            const [status, note, velocity] = message.data;
            
            if (velocity === 0) return; // Ignorer les note off et CC √† 0
            
            console.log('MIDI message re√ßu - Status:', status.toString(16), 'Note/CC:', note, 'Velocity:', velocity);
            
            // Messages Note On (0x90)
            if (status === 0x90) {
                // Boutons ronds de droite (Note On: 89, 79, 69, 59, 49, 39, 29, 19)
                // IMPORTANT: V√©rifier AVANT les pads car 79,69,59,49,39,29,19 sont dans la plage 11-88!
                const rightButtons = [89, 79, 69, 59, 49, 39, 29, 19];
                if (rightButtons.includes(note)) {
                    const btnIndex = rightButtons.indexOf(note);
                    const btnNames = ['Volume/STANDARD', 'Pan/ROOM', 'SendA/POWER', 'SendB/SYNTH', 'Stop/BRUSH', 'Mute/ORCHESTRA', 'Solo/STOP', 'RecordArm/PAUSE'];
                    
                    console.log(`‚úì Bouton droit ${btnIndex} cliqu√© - Note ${note} - Fonction: ${btnNames[btnIndex]}`);
                    
                    if (btnIndex < 6) {
                        // Les 6 premiers = drum sets
                        console.log(`‚Üí S√©lection drum set ${btnIndex}`);
                        selectDrumset(btnIndex);
                    } else if (btnIndex === 6) {
                        // Solo = STOP
                        console.log('‚Üí STOP d√©clench√©');
                        stopAllRhythms();
                    } else if (btnIndex === 7) {
                        // Record Arm = PAUSE
                        console.log('‚Üí PAUSE/RESUME d√©clench√©');
                        togglePause();
                    }
                    return; // Important: sortir de la fonction apr√®s traitement
                }
                
                // Pads de la grille principale (notes 11-88, SAUF les boutons de droite)
                // Pattern: ligne√ó10 + colonne + 1 (ligne 1 = bas, col 1 = gauche)
                if (note >= 11 && note <= 88) {
                    const tens = Math.floor(note / 10);
                    const ones = note % 10;
                    
                    // V√©rifier que c'est une note valide (pas de 9, 0 dans les unit√©s)
                    if (ones >= 1 && ones <= 8 && tens >= 1 && tens <= 8) {
                        const row = tens - 1; // Ligne 0-7 (0 = bas)
                        const col = ones - 1; // Colonne 0-7 (0 = gauche)
                        console.log(`‚úì Pad cliqu√© - Note ${note} -> Row: ${row}, Col: ${col}`);
                        handlePadClick(row, col);
                    } else {
                        console.log(`‚ö†Ô∏è Note ${note} dans la plage 11-88 mais invalide (tens=${tens}, ones=${ones})`);
                    }
                } else {
                    console.log(`‚ö†Ô∏è Note On non g√©r√©e: ${note}`);
                }
            }
            // Messages Control Change (0xB0) - pour les boutons du haut
            else if (status === 0xB0) {
                console.log('CC message - Controller:', note, 'Value:', velocity);
                
                // Boutons du haut (CC 104-111)
                // 104=Up, 105=Down, 106=Left, 107=Right, 108=Session, 109=User1, 110=User2, 111=Mixer
                if (note >= 104 && note <= 111) {
                    const btnIndex = note - 104;
                    const ccNames = ['Up/Tempo+', 'Down/Tempo-', 'Left', 'Right', 'Session', 'User1', 'User2', 'Mixer'];
                    console.log(`‚úì Bouton haut ${btnIndex} cliqu√© - CC ${note} - Fonction: ${ccNames[btnIndex]}`);
                    
                    // Left (CC 106) = Fill Left
                    else if (note === 106) {
                        console.log('‚Üí Fill Left');
                        playFill('fillLeft');
                    }
                    // Right (CC 107) = Fill Right
                    else if (note === 107) {
                        console.log('‚Üí Fill Right');
                        playFill('fillRight');
                    }
                    // Up (CC 104) = Tempo +
                    else if (note === 104) {
                        console.log('‚Üí Tempo +5');
                        adjustTempo(5);
                    }
                    // Down (CC 105) = Tempo -
                    else if (note === 105) {
                        console.log('‚Üí Tempo -5');
                        adjustTempo(-5);
                    }
                    // User 1 (CC 109) = Activer USER 1
                    else if (note === 109) {
                        console.log('‚Üí Activation USER 1');
                        switchUserMode(1);
                    }
                    // User 2 (CC 110) = Activer USER 2
                    else if (note === 110) {
                        console.log('‚Üí Activation USER 2');
                        switchUserMode(2);
                    }
                }
            }
        }

        // Initialiser au chargement
        window.addEventListener('load', init);
    </script>
</body>
</html>